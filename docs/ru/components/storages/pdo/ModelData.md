[Вернуться к оглавлению](../../index.md)

# ModelData

`ModelData` — удобная «обёртка»‑контейнер над массивом атрибутов модели. Наследуется от `AttributeContainer` и располагается в пространстве имён `Scaleum\Storages\PDO`. Класс выполняет *натурализацию* входного массива (приводит ключи/значения к каноничному виду) и умеет рекурсивно преобразовывать вложенные объекты/модели к массиву.

## Методы

| Подпись                               | Возвращаемый тип | Доступ    | Назначение |
| ------------------------------------- | ---------------- | --------- | ---------- |
| `__construct(array $attributes = [])` | —                | public    | Принимает исходные атрибуты, пропускает их через `ArrayHelper::naturalize()` и передаёт в базовый `AttributeContainer`.           |
| `toArray(): array`                    | `array`          | public    | Возвращает массив атрибутов, предварительно нормализуя каждое значение через `normalizeValue()`.                                  |
| `isEmpty(): bool`                     | `bool`           | public    | Определяет, пустой ли контейнер (проверяет количество атрибутов через `getAttributeCount()`).                                     |
| `normalizeValue(mixed $value): mixed` | `mixed`          | protected | Рекурсивно нормализует значения: разворачивает вложенные `ModelData`, `ModelAbstract`, объекты с методом `toArray()` или массивы. |

## Алгоритм `normalizeValue()`

1. **Вложенный `ModelData`** → возвращает `$value->toArray()`.
2. **Вложенная модель (`ModelAbstract`)** → использует `$value->getData()->toArray()`.
3. **Объект с методом `toArray()`** → вызывает его.
4. **Массив** → применяет нормализацию ко всем элементам рекурсивно.
5. **Прочие значения** → возвращает «как есть».

## Пример использования

```php
<?php

declare(strict_types=1);

use Scaleum\Storages\PDO\ModelData;

// Входные данные (могут содержать под‑массивы и объекты‑модели)
$raw = [
    'id'       => 42,
    'name'     => 'Alice',
    'settings' => [
        'notifications' => true,
    ],
];

$modelData = new ModelData($raw); // переменная lowerCamelCase

// Конвертация к массиву (при необходимости рекурсивно преобразует вложенные объекты)
print_r($modelData->toArray());

// Проверка, что контейнер не пуст
if (! $modelData->isEmpty()) {
    // ...
}
```

## Практические советы

* **Immutable‑подход**: не изменяйте массив атрибутов напрямую — используйте методы `AttributeContainer` (`setAttribute()`, `getAttribute()`) для контроля целостности.
* **Вложенные структуры**: если ваша модель содержит вложенные модели/объекты, `ModelData` автоматически «сплющит» их, делая JSON‑сериализацию простой.
* **Функциональное хранение**: `ModelData` удобно хранить в качестве отдельного свойства модели (`getData()`), не смешивая бизнес‑логику с данными.

[Вернуться к оглавлению](../../index.md)
